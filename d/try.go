package d

// Try calls f() and recovers from any panics caused by using d.Exp. The error generated by the call to d.Exp is returned.
func Try(f func()) (err error) {
	defer nomsRecover(&err)
	f()
	return
}

// TODO: I think a better name for this might be like UsageError. That's really what it's intended for: telling the caller "you're holding it wrong".
type nomsError struct {
	msg string
}

func (e nomsError) Error() string {
	return e.msg
}

func nomsRecover(errp *error) {
	if r := recover(); r != nil {
		if _, ok := r.(nomsError); !ok {
			panic(r)
		}
		*errp = r.(error)
	}
}
